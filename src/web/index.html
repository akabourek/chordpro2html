<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChordPro to HTML</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    .container { display: flex; gap: 2rem; }
    textarea { width: 50%; min-height: 400px; font-family: monospace; font-size: 14px; }
    #preview { width: 50%; border: 1px solid #ccc; padding: 1rem; }

    /* renderer styles for preview */
    .song-title { margin: 0 0 0.25em; }
    .song-subtitle { margin: 0 0 0.5em; font-weight: normal; }
    .comment { font-style: italic; margin: 0.5em 0; }
    .comment-box { border: 1px solid #000; padding: 0.25em 0.5em; font-style: normal; }
    .section { margin: 1em 0; break-inside: avoid; }
    .section-chorus { border-left: 3px solid #000; padding-left: 0.75em; }
    .section-tab { font-family: monospace; white-space: pre; font-weight: bold; line-height: 0.5; }
    .section-tab .line { display: block; }
    .section-label { font-weight: bold; margin-bottom: 0.25em; }
    .line { display: flex; flex-wrap: wrap; margin: 0; line-height: 1.1; }
    .chord-lyric { display: inline-flex; flex-direction: column; margin-right: 0; }
    .chord { font-weight: bold; color: #d00; font-size: 0.9em; min-height: 1.2em; white-space: pre; padding-right: 0.4em; }
    .lyric { white-space: pre; }
    .empty-line { height: 1em; }
    .meta { color: #666; margin: 0.25em 0; }

    /* toolbar styles */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1rem 0;
    }
    .transpose-controls {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    .transpose-controls button.step-btn {
      width: 2rem;
      height: 2rem;
      font-size: 1.1rem;
      border: 1px solid #999;
      border-radius: 4px;
      background: #f5f5f5;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .transpose-controls button:hover { background: #e0e0e0; }
    .transpose-value {
      min-width: 3rem;
      text-align: center;
      font-weight: bold;
      font-size: 0.95rem;
    }
    .reset-btn {
      padding: 0.25rem 0.75rem;
      border: 1px solid #999;
      border-radius: 4px;
      background: #f5f5f5;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .reset-btn:hover { background: #e0e0e0; }
    .notation-controls {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    .notation-controls select {
      padding: 0.25rem 0.4rem;
      border: 1px solid #999;
      border-radius: 4px;
      background: #f5f5f5;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .print-btn {
      margin-left: auto;
      padding: 0.5rem 1rem;
      background: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .print-btn:hover { background: #0052a3; }

    /* print styles */
    @media print {
      body > h1, .container > textarea, .toolbar { display: none; }
      .container { display: block; }
      #preview { width: 100%; border: none; }
    }
  </style>
</head>
<body>
  <h1>ChordPro to HTML</h1>
  <div class="toolbar">
    <div class="transpose-controls">
      <span style="font-size: 0.85rem;">Transpose:</span>
      <button id="transpose-down" class="step-btn" title="Transpose down">-</button>
      <span id="transpose-value" class="transpose-value">0</span>
      <button id="transpose-up" class="step-btn" title="Transpose up">+</button>
      <button id="transpose-reset" class="reset-btn">Reset</button>
    </div>
    <div class="notation-controls">
      <span style="font-size: 0.85rem;">Notation:</span>
      <select id="notation">
        <option value="">Auto</option>
        <option value="standard">Standard (B)</option>
        <option value="german">German (H/B)</option>
      </select>
    </div>
    <div class="notation-controls">
      <span style="font-size: 0.85rem;">Columns:</span>
      <select id="columns">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </div>
    <button class="print-btn" onclick="window.print()">Print</button>
  </div>
  <div class="container">
    <textarea id="editor" placeholder="Paste ChordPro here...">{title: Amazing Grace}
{subtitle: John Newton}
{key: G}
{comment: Capo 2}

{start_of_verse: Verse 1}
[G]Amazing [G7]grace, how [C]sweet the [G]sound
That [G]saved a [Em]wretch like [D]me
[G]I once was [G7]lost, but [C]now am [G]found
Was [G]blind, but [D7]now I [G]see
{end_of_verse}

{start_of_chorus}
[G]Through many [G7]dangers, [C]toils and [G]snares
I [Em]have al[D]ready [G]come
{end_of_chorus}

{start_of_tab}
e|---3---3---0---3---|
B|---0---0---1---0---|
G|---0---0---0---0---|
D|---0---0---2---0---|
A|---2---x---3---2---|
E|---3---3-------3---|
{end_of_tab}</textarea>
    <div id="preview"></div>
  </div>
  <script type="module">
    import { chordproToHtml } from "../lib/index.ts";

    const editor = document.getElementById("editor");
    const preview = document.getElementById("preview");
    const transposeValueEl = document.getElementById("transpose-value");
    const transposeUpBtn = document.getElementById("transpose-up");
    const transposeDownBtn = document.getElementById("transpose-down");
    const transposeResetBtn = document.getElementById("transpose-reset");
    const notationSelect = document.getElementById("notation");
    const columnsSelect = document.getElementById("columns");

    let transposeSemitones = 0;

    function update() {
      const opts = { transpose: transposeSemitones };
      const notation = notationSelect.value;
      if (notation) opts.notation = notation;
      const cols = Number(columnsSelect.value);
      if (cols > 1) opts.columns = cols;
      preview.innerHTML = chordproToHtml(editor.value, opts);
      transposeValueEl.textContent = (transposeSemitones > 0 ? "+" : "") + transposeSemitones;
    }

    editor.addEventListener("input", update);
    notationSelect.addEventListener("change", update);
    columnsSelect.addEventListener("change", update);

    transposeUpBtn.addEventListener("click", () => {
      transposeSemitones++;
      update();
    });

    transposeDownBtn.addEventListener("click", () => {
      transposeSemitones--;
      update();
    });

    transposeResetBtn.addEventListener("click", () => {
      transposeSemitones = 0;
      update();
    });

    update();
  </script>
</body>
</html>
